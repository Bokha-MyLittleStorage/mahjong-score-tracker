<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mahjong Score Tracker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    h1 {
      margin-bottom: 20px;
    }
    table {
      border-collapse: collapse;
      margin: 20px 0;
    }
    table, th, td {
      border: 1px solid black;
      padding: 10px;
      text-align: center;
    }
    #message {
      font-size: 24px;
      margin-bottom: 20px;
    }
    .player-buttons {
      margin-top: 10px;
      display: flex;
      justify-content: space-around;
      width: 100%;
    }
    .input-area {
      margin-top: 10px;
    }
    .input-field {
      padding: 8px;
      font-size: 16px;
    }
    .input-btn {
      padding: 8px;
      font-size: 16px;
      margin-left: 10px;
    }
    .select-btn {
      margin-top: 5px;
      padding: 6px 12px;
    }
  </style>
</head>
<body>

<h1 id="message">4인 마작 점수판</h1>
<table id="scoreboard">
  <tr>
    <th>플레이어 1</th>
    <th>플레이어 2</th>
    <th>플레이어 3</th>
    <th>플레이어 4</th>
  </tr>
  <tr>
    <td><input type="number" id="score1" class="score-input" value="25000"></td>
    <td><input type="number" id="score2" class="score-input" value="25000"></td>
    <td><input type="number" id="score3" class="score-input" value="25000"></td>
    <td><input type="number" id="score4" class="score-input" value="25000"></td>
  </tr>
  <tr>
    <td id="diff1"></td>
    <td id="diff2"></td>
    <td id="diff3"></td>
    <td id="diff4"></td>
  </tr>
</table>

<!-- 플레이어별 버튼 -->
<div class="player-buttons">
  <div>
    <button onclick="tsumo(1)">쯔모</button>
    <button onclick="ron(1)">론</button>
    <button onclick="riichi(1)">리치</button>
    <button class="select-btn" id="select1" onclick="selectPlayer(1)">선택</button>
  </div>
  <div>
    <button onclick="tsumo(2)">쯔모</button>
    <button onclick="ron(2)">론</button>
    <button onclick="riichi(2)">리치</button>
    <button class="select-btn" id="select2" onclick="selectPlayer(2)">선택</button>
  </div>
  <div>
    <button onclick="tsumo(3)">쯔모</button>
    <button onclick="ron(3)">론</button>
    <button onclick="riichi(3)">리치</button>
    <button class="select-btn" id="select3" onclick="selectPlayer(3)">선택</button>
  </div>
  <div>
    <button onclick="tsumo(4)">쯔모</button>
    <button onclick="ron(4)">론</button>
    <button onclick="riichi(4)">리치</button>
    <button class="select-btn" id="select4" onclick="selectPlayer(4)">선택</button>
  </div>
</div>

<!-- 점수 입력란 -->
<div class="input-area">
  <input type="text" id="input-field" class="input-field">
  <button class="input-btn" onclick="submitInput()">입력</button>
</div>
<script>
  let scores = [25000, 25000, 25000, 25000];
  let kyotaku = 0;
  let inputMode = null;  // 현재 입력받고 있는 모드 ('oya', 'loser', 'payment' 등)
  let selectedPlayer = null;

  function updateUI() {
    document.getElementById('score1').value = scores[0];
    document.getElementById('score2').value = scores[1];
    document.getElementById('score3').value = scores[2];
    document.getElementById('score4').value = scores[3];

    document.getElementById('diff1').textContent = '';
    document.getElementById('diff2').textContent = scores[1] - scores[0];
    document.getElementById('diff3').textContent = scores[2] - scores[0];
    document.getElementById('diff4').textContent = scores[3] - scores[0];
    document.getElementById('kyotaku').innerText = `공탁금: ${kyotaku}점`;  // 공탁금 표시
  }

  function setMessage(msg) {
    document.getElementById('message').textContent = msg;
  }

  function resetMessage() {
    document.getElementById('message').textContent = '4인 마작 점수판';
  }

  function selectPlayer(player) {
  if (inputMode === 'oya') {
    if ( selectedPlayer === player) {
    selectedOya = player;
    oyaScore = 0;
    setMessage('나머지 플레이어에게서 받아올 점수를 입력하세요.');
    inputMode = 'othersPayment';    
    } else {    
    selectedOya = player;
    setMessage('오야에게서 받아올 점수를 입력하세요.');
    inputMode = 'oyaPayment';
    }
  } else if (inputMode === 'oyaPayment') {
    let oyaPayment = parseInt(document.getElementById('paymentInput').value);
    setMessage('나머지 플레이어에게서 받아올 점수를 입력하세요.');
    inputMode = 'othersPayment';
    oyaScore = oyaPayment;
  } else if (inputMode === 'othersPayment') {
    let othersPayment = parseInt(document.getElementById('paymentInput').value);
    scores[selectedOya] -= oyaScore;
    scores[selectedPlayer] += oyaScore;
    for (let i = 0; i < scores.length; i++) {
      if (i !== selectedPlayer && i !== selectedOya) {
        scores[i] -= othersPayment;
        scores[selectedPlayer] += othersPayment;
      }
    transferPointsToWinner(selectedPlayer)
    }
    inputMode = '';
    updateUI();
  } else if (inputMode === 'loser') {
    selectedLoser = player;
    setMessage('방총자로부터 받아올 점수를 입력하세요.');
    inputMode = 'payment';
  } else if (inputMode === 'payment') {
    let payment = parseInt(document.getElementById('paymentInput').value);
    scores[selectedLoser] -= payment;  // 방총자의 점수 감소
    scores[selectedPlayer] += payment;  // 론한 플레이어의 점수 증가
    transferPointsToWinner(selectedPlayer);  // 공탁금도 가져옴
    inputMode = '';
    updateUI();
}

  function submitInput() {
    const inputValue = document.getElementById('input-field').value;
    if (!inputValue || isNaN(inputValue)) {
      alert('유효한 숫자를 입력하세요.');
      return;
    }
    const points = parseInt(inputValue);
    if (inputMode === 'payment') {
      handlePayment(points);
    }
  }
function tsumo(player) {
  setMessage('오야를 선택하세요.');
  inputMode = 'oya';
  selectedPlayer = player;
}

function ron(player) {
  setMessage('방총자를 선택하세요.');
  inputMode = 'loser';
  selectedPlayer = player;
}
  function riichi(player) {
    if (scores[player - 1] >= 1000) {
      scores[player - 1] -= 1000;
      kyotaku += 1000;
      updateUI();
      resetMessage();
    } else {
      alert('리치를 선언할 충분한 점수가 없습니다.');
    }
  }
  function transferPointsToWinner(winner) {
  scores[winner] += kyotaku;  // 공탁금 전체를 승자에게 넘김
  kyotaku = 0;  // 공탁금 초기화
  updateUI();
}
  function handlePayment(points) {
    if (selectedPlayer !== null) {
      scores[selectedPlayer - 1] -= points;
      updateUI();
      resetMessage();
    }
    selectedPlayer = null;
    inputMode = null;
  }
</script>
<script>
  function saveScores() {
    localStorage.setItem('scores', JSON.stringify(scores));
    localStorage.setItem('kyotaku', kyotaku);
  }

  function loadScores() {
    const savedScores = localStorage.getItem('scores');
    const savedKyotaku = localStorage.getItem('kyotaku');
    if (savedScores) {
      scores = JSON.parse(savedScores);
      kyotaku = parseInt(savedKyotaku, 10) || 0;
      updateUI();
    }
  }

  window.onload = function() {
    loadScores();
    updateUI();
  };
</script>
</body>
</html>
